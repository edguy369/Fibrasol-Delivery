@{
    ViewData["Title"] = "Reporte de Ventas";
}

<link rel="stylesheet" href="~/css/salesperson/report.css" />

<div class="page-header mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="mb-2"><i class="bi bi-graph-up me-3"></i>Reporte de Ventas</h1>
            <p class="mb-0 opacity-75">Análisis de desempeño de vendedores</p>
        </div>
        <div class="d-flex gap-2">
            <button type="button" class="btn btn-light" onclick="exportReport()">
                <i class="bi bi-download me-2"></i>Exportar
            </button>
            <button type="button" class="btn btn-light" onclick="refreshReport()">
                <i class="bi bi-arrow-clockwise me-2"></i>Actualizar
            </button>
        </div>
    </div>
</div>

<!-- Date Range Filter -->
<div class="filter-container">
    <div class="row align-items-end">
        <div class="col-md-3">
            <label for="startDate" class="form-label">Fecha Inicio</label>
            <input type="date" class="form-control" id="startDate">
        </div>
        <div class="col-md-3">
            <label for="endDate" class="form-label">Fecha Fin</label>
            <input type="date" class="form-control" id="endDate">
        </div>
        <div class="col-md-3">
            <label class="form-label">Período Rápido</label>
            <select class="form-control" id="quickPeriod" onchange="applyQuickPeriod()">
                <option value="">Seleccionar período</option>
                <option value="thisMonth">Este mes</option>
                <option value="lastMonth">Mes anterior</option>
                <option value="thisQuarter">Este trimestre</option>
                <option value="thisYear">Este año</option>
                <option value="lastYear">Año anterior</option>
            </select>
        </div>
        <div class="col-md-3">
            <button type="button" class="btn btn-primary-custom w-100" onclick="generateReport()">
                <i class="bi bi-search me-2"></i>Generar Reporte
            </button>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4" id="statsContainer">
    <div class="col-md-3">
        <div class="stats-card">
            <div class="stats-number" id="totalSales">Q 0.00</div>
            <div class="stats-label">Ventas Totales</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <div class="stats-number" id="avgSales">Q 0.00</div>
            <div class="stats-label">Promedio por Vendedor</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <div class="stats-number" id="topSeller">-</div>
            <div class="stats-label">Mejor Vendedor</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stats-card">
            <div class="stats-number" id="totalSellers">0</div>
            <div class="stats-label">Total Vendedores</div>
        </div>
    </div>
</div>

<!-- Chart Container -->
<div class="chart-container">
    <div class="loading-overlay" id="chartLoading">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <div class="mt-2">Generando gráfico...</div>
        </div>
    </div>
    <canvas id="salesChart"></canvas>
</div>

<!-- Data Table -->
<div class="table-container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Detalle de Ventas por Vendedor</h5>
        <span class="badge bg-primary" id="reportPeriod">Mes actual</span>
    </div>
    <table id="salesTable" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Ranking</th>
                <th>Vendedor</th>
                <th>Total Ventas</th>
                <th>% del Total</th>
                <th>Performance</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be loaded via JavaScript -->
        </tbody>
    </table>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

    <script src="~/js/salesperson/report.js"></script>
}