const FibrasolUtils=function(){"use strict";const e={async get(e){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()},async post(e,t){return await this.request(e,"POST",t)},async put(e,t){return await this.request(e,"PUT",t)},async delete(e,t={}){return await this.request(e,"DELETE",t)},async request(e,t,a){const r=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()},ajax:e=>$.ajax({contentType:"application/json",...e})},t={showSuccessMessage(e){const t=`\n                <div class="alert alert-success alert-dismissible fade show" role="alert">\n                    <i class="bi bi-check-circle me-2"></i>${e}\n                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n                </div>`;$(".page-header").after(t),setTimeout(()=>$(".alert-success").fadeOut(),3e3)},showErrorMessage(e){const t=`\n                <div class="alert alert-warning alert-dismissible fade show" role="alert">\n                    <i class="bi bi-exclamation-triangle me-2"></i>${e}\n                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n                </div>`;$(".page-header").after(t),setTimeout(()=>$(".alert-warning").fadeOut(),5e3)},setButtonLoading(e,t=!0){t?(e.dataset.originalText=e.innerHTML,e.disabled=!0,e.innerHTML='<span class="spinner-border spinner-border-sm me-2"></span>Guardando...'):(e.disabled=!1,e.innerHTML=e.dataset.originalText||"Guardar")},showModal(e){new bootstrap.Modal(document.getElementById(e)).show()},hideModal(e){const t=bootstrap.Modal.getInstance(document.getElementById(e));t&&t.hide()},updateCounter(e,t,a=!0){const r=document.getElementById(e);r&&(a?(r.style.opacity="0.5",setTimeout(()=>{r.textContent=t.toLocaleString("es-GT"),r.style.opacity="1"},200)):r.textContent=t.toLocaleString("es-GT"))}},a={getSpanishConfig:()=>({language:{url:"https://cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"},pageLength:10,responsive:!0}),createActionButtons(e,t,a){const{editFn:r,deleteFn:o}=a;return`\n                <button type="button" class="btn btn-edit btn-sm me-1" onclick="${r}(${e}, '${t.replace(/'/g,"\\'")}')">\n                    <i class="bi bi-pencil"></i>\n                </button>\n                <button type="button" class="btn btn-delete btn-sm" onclick="${o}(${e})">\n                    <i class="bi bi-trash"></i>\n                </button>`},reloadTable(e){$(`#${e}`).DataTable().ajax.reload()}},r={lockForm(){$("input, select, textarea, button").prop("disabled",!0)},unlockForm(){$("input, select, textarea, button").prop("disabled",!1)},resetModal(e){e.forEach(e=>{const t=document.getElementById(e.id);t&&(t.value=e.value||"")})},validateRequired(e){for(const t of e){const e=document.getElementById(t)?.value.trim();if(!e)return alert(`Por favor, complete el campo: ${t}`),!1}return!0},getFormData(e){const t={};return e.forEach(e=>{const a=document.getElementById(e.id);a&&(t[e.name]=a.value.trim())}),t}},o={async create(r){const{url:o,data:s,tableId:n,successMessage:i,errorMessage:l}=r;try{await e.post(o,s),t.hideModal(r.modalId),t.showSuccessMessage(i||"Creado correctamente"),n&&a.reloadTable(n)}catch(e){console.error("Error creating:",e),t.showErrorMessage(l||"Error al crear. Inténtelo de nuevo.")}},async update(r){const{url:o,id:s,data:n,tableId:i,successMessage:l,errorMessage:c}=r;try{await e.put(`${o}/${s}`,n),t.hideModal(r.modalId),t.showSuccessMessage(l||"Actualizado correctamente"),i&&a.reloadTable(i)}catch(e){console.error("Error updating:",e),t.showErrorMessage(c||"Error al actualizar. Inténtelo de nuevo.")}},async delete(r){const{url:o,id:s,tableId:n,confirmMessage:i,successMessage:l,errorMessage:c}=r;if(confirm(i||"¿Está seguro de eliminar este elemento?"))try{await e.delete(`${o}/${s}`),t.showSuccessMessage(l||"Eliminado correctamente"),n&&a.reloadTable(n)}catch(e){console.error("Error deleting:",e),t.showErrorMessage(c||"Error al eliminar. Inténtelo de nuevo.")}}};return{api:e,ui:t,datatables:a,forms:r,crud:o,dates:{formatDate:(e,t="es-GT")=>new Date(e).toLocaleDateString(t),formatDateTime(e,t="es-GT"){const a=new Date(e);return a.toLocaleDateString(t)+" "+a.toLocaleTimeString(t,{hour:"2-digit",minute:"2-digit"})},getFirstDayOfMonth(){const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)},getLastDayOfMonth(){const e=new Date;return new Date(e.getFullYear(),e.getMonth()+1,0)},toInputFormat:e=>e.toISOString().split("T")[0]},currency:{format:(e,t="es-GT")=>"Q "+parseFloat(e).toLocaleString(t,{minimumFractionDigits:2,maximumFractionDigits:2}),formatWithSymbol:(e,t="Q",a="es-GT")=>`${t} ${parseFloat(e).toLocaleString(a,{minimumFractionDigits:2,maximumFractionDigits:2})}`,parse:e=>parseFloat(e)||0},utils:{debounce(e,t){let a;return function(...r){clearTimeout(a),a=setTimeout(()=>e.apply(this,r),t)}},getUrlParam:e=>new URLSearchParams(window.location.search).get(e),getIdFromUrl(e=-1){const t=window.location.pathname.split("/");return t[t.length+e]},escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}}}();function LockForm(){FibrasolUtils.forms.lockForm()}function UnlockForm(){FibrasolUtils.forms.unlockForm()}window.FibrasolUtils=FibrasolUtils;