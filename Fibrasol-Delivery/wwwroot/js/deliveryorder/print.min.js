const pathParts=window.location.pathname.split("/"),orderId=pathParts[pathParts.length-2];async function loadDeliveryOrderData(){try{const t=await FibrasolUtils.api.get(`/delivery-orders/${orderId}`);t?populateOrderData(t):(console.error("No order data found"),alert("No se encontraron datos de la orden"))}catch(t){console.error("Error loading delivery order:",t),alert("Error al cargar los datos de la orden")}}function populateOrderData(t){document.getElementById("orderNumber").textContent=t.id;const e=new Date(t.createdAt||new Date).toLocaleDateString("es-GT",{day:"numeric",month:"short"});document.getElementById("orderDate").textContent=e,populateTable(t),document.getElementById("totalAmount").textContent=FibrasolUtils.currency.format(t.total),populatePilots(t)}function populatePilots(t){const e=document.getElementById("pilotsNames");if(t.riders&&t.riders.length>0){const n=t.riders.map(t=>t.name.toUpperCase());let r="";if(1===n.length)r=`<strong>${n[0]}</strong>`;else if(2===n.length)r=`<strong>${n[0]}</strong> &nbsp;&nbsp;&nbsp; Y &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>${n[1]}</strong>`;else{const t=n.pop();r=`${n.map(t=>`<strong>${t}</strong>`).join(" &nbsp;&nbsp;&nbsp; ")} &nbsp;&nbsp;&nbsp; Y &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>${t}</strong>`}e.innerHTML=r}else e.innerHTML="<strong>SIN ASIGNAR</strong>"}function populateTable(t){const e=document.getElementById("deliveryTableBody");e.innerHTML="",t.backorders&&0!==t.backorders.length?t.backorders.forEach(t=>{if(t.invoices&&0!==t.invoices.length)t.invoices.forEach((n,r)=>{const s=document.createElement("tr");s.innerHTML=0===r?`\n                        <td class="client-cell" rowspan="${t.invoices.length}">${t.client?t.client.name:"N/A"}</td>\n                        <td class="address-cell">${n.address||"N/A"}</td>\n                        <td>${n.reference||"N/A"}</td>\n                        <td>${FibrasolUtils.currency.format(n.value||0)}</td>\n                        <td></td>\n                        <td class="client-cell" rowspan="${t.invoices.length}">${t.number||"N/A"}</td>\n                        <td class="client-cell" rowspan="${t.invoices.length}">${t.weight?t.weight.toFixed(1):"0.0"}</td>\n                    `:`\n                        <td class="address-cell">${n.address||"N/A"}</td>\n                        <td>${n.reference||"N/A"}</td>\n                        <td>${FibrasolUtils.currency.format(n.value||0)}</td>\n                        <td></td>\n                    `,e.appendChild(s)});else{const n=document.createElement("tr");n.innerHTML=`\n                <td class="client-cell">${t.client?t.client.name:"N/A"}</td>\n                <td class="address-cell">N/A</td>\n                <td>N/A</td>\n                <td>Q0.00</td>\n                <td></td>\n                <td>${t.number||"N/A"}</td>\n                <td>${t.weight?t.weight.toFixed(1):"0.0"}</td>\n            `,e.appendChild(n)}}):e.innerHTML='<tr><td colspan="7">No hay comandas para mostrar</td></tr>'}document.addEventListener("DOMContentLoaded",loadDeliveryOrderData);